######################################################################
# Microsoft Visual C++ Makefile for the libpopcnt C/C++ library
######################################################################

CXX      = cl /nologo
CXXFLAGS = /W2 /O2 /EHsc
LINK     = link /nologo

#-----------------------------------------------------------------------------
# Default targets
#-----------------------------------------------------------------------------

all: test.exe

#-----------------------------------------------------------------------------
# Compilation rules
#-----------------------------------------------------------------------------

test.exe: $(@B).cpp libpopcnt.h
	$(CXX) $(CXXFLAGS) $(@B).cpp /Fo$@

#-----------------------------------------------------------------------------
# `nmake -f Makefile.msvc check` runs correctness tests
#-----------------------------------------------------------------------------

check test: test.exe
	test.exe

#-----------------------------------------------------------------------------
# Clean output directories
#-----------------------------------------------------------------------------

clean:
	-del *.exe *.obj
